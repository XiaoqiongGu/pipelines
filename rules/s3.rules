"""Rules for interacting with AWS's S3
"""


from snakemake.remote.S3 import RemoteProvider as S3RemoteProvider
# works without access_key_id and secret_access_key on cfncluster
# (assuming correctly set permissions)
S3 = S3RemoteProvider()


rule copy_fastq_from_s3:
    input:
        S3.remote("{prefix}.fastq.gz")
    output:
        temp("s3/{prefix}.fastq.gz")
    log:
        "s3/{prefix}.log"
    message:
        "S3 copy from {input} to {output}"
    shell:
	# copy file, keeping input structure
        "rsync -av {input} $(dirname {output})/ >& {log}"

